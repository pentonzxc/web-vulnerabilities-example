<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="#" />
  </head>
  <body>
    <div id="postsContainer"></div>

    <script nonce="rAnd0m">
      function fetchPosts(currentUrl) {
        console.log("Request posts");
        fetch(currentUrl, {
          method: "GET",
          headers: {
            Accept: "application/json",
          },
        })
          .then((response) => {
            if (response.status != "200") {
              response.text().then((errorCode) => {
                const container = document.getElementById("postsContainer");
                container.innerHTML = `Something went wrong: ${errorCode}`;
              });

              throw new Error("Can't request posts");
            }
            return response.json();
          })
          .then((data) => {
            const container = document.getElementById("postsContainer");

            data.forEach((post) => {
              const postElement = document.createElement("div");
              postElement.innerHTML = `
                <h3>${post.content}</h3>
                <p>Posted by: ${post.userId}</p>
                <hr>`;

              console.log(post);

              container.appendChild(postElement);
            });
          });
      }

      // TODO: somehow fix that
      fetchPosts("http://localhost:8080/posts/pavel");
    </script>
  </body>
</html>
